{
  "version": 3,
  "file": "nsis.js",
  "sourceRoot": "",
  "sources": [
    "../../src/targets/nsis.ts"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "import BluebirdPromise from \"bluebird-lst\"\nimport { Arch, Target } from \"electron-builder-core\"\nimport { asArray, debug, doSpawn, exec, getPlatformIconFileName, handleProcess, isEmptyOrSpaces, use } from \"electron-builder-util\"\nimport { getBinFromBintray } from \"electron-builder-util/out/binDownload\"\nimport { copyFile } from \"electron-builder-util/out/fs\"\nimport { log, subTask, warn } from \"electron-builder-util/out/log\"\nimport { asyncAll } from \"electron-builder-util/out/promise\"\nimport { outputFile, readFile, unlink } from \"fs-extra-p\"\nimport { safeLoad } from \"js-yaml\"\nimport * as path from \"path\"\nimport sanitizeFileName from \"sanitize-filename\"\nimport { v5 as uuid5 } from \"uuid-1345\"\nimport { NsisOptions, PortableOptions } from \"../options/winOptions\"\nimport { normalizeExt } from \"../platformPackager\"\nimport { getSignVendorPath } from \"../windowsCodeSign\"\nimport { WinPackager } from \"../winPackager\"\nimport { archive } from \"./archive\"\nimport { bundledLanguages, getLicenseFiles, lcid, toLangWithRegion } from \"./license\"\n\n// noinspection SpellCheckingInspection\nconst ELECTRON_BUILDER_NS_UUID = \"50e065bc-3134-11e6-9bab-38c9862bdaf3\"\n\n// noinspection SpellCheckingInspection\nconst nsisPathPromise = getBinFromBintray(\"nsis\", \"3.0.1.10\", \"302a8adebf0b553f74cddd494154a586719ff9d4767e94d8a76547a9bb06200c\")\n// noinspection SpellCheckingInspection\nconst nsisResourcePathPromise = getBinFromBintray(\"nsis-resources\", \"3.0.0\", \"cde0e77b249e29d74250bf006aa355d3e02b32226e1c6431fb48facae41d8a7e\")\n\nconst USE_NSIS_BUILT_IN_COMPRESSOR = false\n\ninterface PackageFileInfo {\n  file: string\n}\n\nexport class AppPackageHelper {\n  private readonly archToFileInfo = new Map<Arch, Promise<PackageFileInfo>>()\n  private readonly infoToIsDelete = new Map<PackageFileInfo, boolean>()\n\n  /** @private */\n  refCount = 0\n\n  async packArch(arch: Arch, target: NsisTarget) {\n    let infoPromise = this.archToFileInfo.get(arch)\n    if (infoPromise == null) {\n      infoPromise = subTask(`Packaging NSIS installer for arch ${Arch[arch]}`, target.buildAppPackage(target.archs.get(arch)!, arch))\n        .then(it => {return {file: it} })\n      this.archToFileInfo.set(arch, infoPromise)\n    }\n\n    const info = await infoPromise\n    if (target.isWebInstaller) {\n      this.infoToIsDelete.set(info, false)\n    }\n    else if (!this.infoToIsDelete.has(info)) {\n      this.infoToIsDelete.set(info, true)\n    }\n    return info.file\n  }\n\n  async finishBuild(): Promise<any> {\n    if (--this.refCount > 0) {\n      return\n    }\n\n    const filesToDelete: Array<string> = []\n    for (let [info, isDelete]  of this.infoToIsDelete.entries()) {\n      if (isDelete) {\n        filesToDelete.push(info.file)\n      }\n    }\n\n    await BluebirdPromise.map(filesToDelete, it => unlink(it))\n  }\n}\n\nexport class NsisTarget extends Target {\n  readonly options: NsisOptions\n\n  /** @private */\n  readonly archs: Map<Arch, string> = new Map()\n\n  private readonly nsisTemplatesDir = path.join(__dirname, \"..\", \"..\", \"templates\", \"nsis\")\n\n  constructor(protected readonly packager: WinPackager, readonly outDir: string, targetName: string, protected readonly packageHelper: AppPackageHelper) {\n    super(targetName)\n\n    this.packageHelper.refCount++\n\n    let options = this.packager.config.nsis || Object.create(null)\n    if (targetName !== \"nsis\") {\n      options = Object.assign(options, (<any>this.packager.config)[targetName === \"nsis-web\" ? \"nsisWeb\" : targetName])\n    }\n    this.options = options\n\n    const deps = packager.info.metadata.dependencies\n    if (deps != null && deps[\"electron-squirrel-startup\"] != null) {\n      warn('\"electron-squirrel-startup\" dependency is not required for NSIS')\n    }\n  }\n\n  async build(appOutDir: string, arch: Arch) {\n    this.archs.set(arch, appOutDir)\n  }\n\n  /** @private */\n  async buildAppPackage(appOutDir: string, arch: Arch) {\n    await BluebirdPromise.all([\n      copyFile(path.join(await nsisPathPromise, \"elevate.exe\"), path.join(appOutDir, \"resources\", \"elevate.exe\"), null, false),\n      copyFile(path.join(await getSignVendorPath(), \"windows-10\", Arch[arch], \"signtool.exe\"), path.join(appOutDir, \"resources\", \"signtool.exe\"), null, false),\n    ])\n\n    const packager = this.packager\n    const format = this.options.useZip ? \"zip\" : \"7z\"\n    const archiveFile = path.join(this.outDir, `${packager.appInfo.name}-${packager.appInfo.version}-${Arch[arch]}.nsis.${format}`)\n    return await archive(packager.config.compression, format, archiveFile, appOutDir, true)\n  }\n\n  // noinspection JSUnusedGlobalSymbols\n  async finishBuild(): Promise<any> {\n    log(\"Building NSIS installer\")\n    try {\n      await this.buildInstaller()\n    }\n    finally {\n      await this.packageHelper.finishBuild()\n    }\n  }\n\n  protected get installerFilenamePattern(): string {\n    return \"${productName} \" + (this.isPortable ? \"\" : \"Setup \") + \"${version}.${ext}\"\n  }\n\n  private get isPortable() {\n    return this.name === \"portable\"\n  }\n\n  private async buildInstaller(): Promise<any> {\n    const isPortable = this.isPortable\n\n    const packager = this.packager\n    const appInfo = packager.appInfo\n    const version = appInfo.version\n    const options = this.options\n    const installerFilename = packager.expandArtifactNamePattern(options, \"exe\", null, this.installerFilenamePattern)\n    const iconPath = (isPortable ? null : await packager.getResource(options.installerIcon, \"installerIcon.ico\")) || await packager.getIconPath()\n    const oneClick = options.oneClick !== false\n\n    const installerPath = path.join(this.outDir, installerFilename)\n    const guid = options.guid || await BluebirdPromise.promisify(uuid5)({namespace: ELECTRON_BUILDER_NS_UUID, name: appInfo.id})\n    const defines: any = {\n      APP_ID: appInfo.id,\n      APP_GUID: guid,\n      PRODUCT_NAME: appInfo.productName,\n      PRODUCT_FILENAME: appInfo.productFilename,\n      APP_FILENAME: (!oneClick || options.perMachine === true) && /^[-_+0-9a-zA-Z ]+$/.test(appInfo.productFilename) ? appInfo.productFilename : appInfo.name,\n      APP_DESCRIPTION: appInfo.description,\n      VERSION: version,\n\n      COMPANY_NAME: appInfo.companyName,\n\n      PROJECT_DIR: packager.projectDir,\n      BUILD_RESOURCES_DIR: packager.buildResourcesDir,\n    }\n\n    // electron uses product file name as app data, define it as well to remove on uninstall\n    if (defines.APP_FILENAME != appInfo.productFilename) {\n      defines.APP_PRODUCT_FILENAME = appInfo.productFilename\n    }\n\n    const commands: any = {\n      OutFile: `\"${installerPath}\"`,\n      VIProductVersion: appInfo.versionInWeirdWindowsForm,\n      VIAddVersionKey: this.computeVersionKey(),\n      Unicode: this.isUnicodeEnabled,\n    }\n\n    if (iconPath != null) {\n      if (isPortable) {\n        commands.Icon = iconPath\n      }\n      else {\n        defines.MUI_ICON = iconPath\n        defines.MUI_UNICON = iconPath\n      }\n    }\n\n    if (this.archs.size === 1 && USE_NSIS_BUILT_IN_COMPRESSOR) {\n      defines.APP_BUILD_DIR = this.archs.get(this.archs.keys().next().value)\n    }\n    else {\n      await BluebirdPromise.map(this.archs.keys(), async arch => {\n        const file = await this.packageHelper.packArch(arch, this, )\n        defines[arch === Arch.x64 ? \"APP_64\" : \"APP_32\"] = file\n        defines[(arch === Arch.x64 ? \"APP_64\" : \"APP_32\") + \"_NAME\"] = path.basename(file)\n\n        if (this.isWebInstaller) {\n          packager.dispatchArtifactCreated(file, this, arch)\n        }\n      })\n    }\n\n    this.configureDefinesForAllTypeOfInstaller(defines)\n    if (isPortable) {\n      defines.REQUEST_EXECUTION_LEVEL = (<PortableOptions>options).requestExecutionLevel || \"user\"\n    }\n    else {\n      await this.configureDefines(oneClick, defines)\n    }\n\n    if (packager.config.compression === \"store\") {\n      commands.SetCompress = \"off\"\n    }\n    else {\n      commands.SetCompressor = \"lzma\"\n      if (!this.isWebInstaller) {\n        defines.COMPRESS = \"auto\"\n      }\n    }\n\n    debug(defines)\n    debug(commands)\n\n    if (packager.packagerOptions.effectiveOptionComputed != null && await packager.packagerOptions.effectiveOptionComputed([defines, commands])) {\n      return\n    }\n\n    const script = isPortable ? await readFile(path.join(this.nsisTemplatesDir, \"portable.nsi\"), \"utf8\") : await this.computeScriptAndSignUninstaller(defines, commands, installerPath)\n    await this.executeMakensis(defines, commands, await this.computeFinalScript(script, true))\n    await packager.sign(installerPath)\n\n    packager.dispatchArtifactCreated(installerPath, this, this.archs.size === 1 ? this.archs.keys().next().value : null, this.generateGitHubInstallerName())\n  }\n\n  protected generateGitHubInstallerName() {\n    const appInfo = this.packager.appInfo\n    const classifier = appInfo.name.toLowerCase() === appInfo.name ? \"setup-\" : \"Setup-\"\n    return `${appInfo.name}-${this.isPortable ? \"\" : classifier}${appInfo.version}.exe`\n  }\n\n  private get isUnicodeEnabled() {\n    return this.options.unicode == null ? true : this.options.unicode\n  }\n\n  get isWebInstaller(): boolean {\n    return false\n  }\n\n  private async computeScriptAndSignUninstaller(defines: any, commands: any, installerPath: string) {\n    const packager = this.packager\n    const customScriptPath = await packager.getResource(this.options.script, \"installer.nsi\")\n    const script = await readFile(customScriptPath || path.join(this.nsisTemplatesDir, \"installer.nsi\"), \"utf8\")\n\n    if (customScriptPath != null) {\n      log(\"Custom NSIS script is used - uninstaller is not signed by electron-builder\")\n      return script\n    }\n\n    const uninstallerPath = await\n    packager.getTempFile(\"uninstaller.exe\")\n    const isWin = process.platform === \"win32\"\n    defines.BUILD_UNINSTALLER = null\n    defines.UNINSTALLER_OUT_FILE = isWin ? uninstallerPath : path.win32.join(\"Z:\", uninstallerPath)\n    await this.executeMakensis(defines, commands, await this.computeFinalScript(script, false))\n    await exec(isWin ? installerPath : \"wine\", isWin ? [] : [installerPath])\n    await packager.sign(uninstallerPath, \"  Signing NSIS uninstaller\")\n\n    delete defines.BUILD_UNINSTALLER\n    // platform-specific path, not wine\n    defines.UNINSTALLER_OUT_FILE = uninstallerPath\n    return script\n  }\n\n  private computeVersionKey() {\n    // Error: invalid VIProductVersion format, should be X.X.X.X\n    // so, we must strip beta\n    const localeId = this.options.language || \"1033\"\n    const appInfo = this.packager.appInfo\n    const versionKey = [\n      `/LANG=${localeId} ProductName \"${appInfo.productName}\"`,\n      `/LANG=${localeId} ProductVersion \"${appInfo.version}\"`,\n      `/LANG=${localeId} CompanyName \"${appInfo.companyName}\"`,\n      `/LANG=${localeId} LegalCopyright \"${appInfo.copyright}\"`,\n      `/LANG=${localeId} FileDescription \"${appInfo.description}\"`,\n      `/LANG=${localeId} FileVersion \"${appInfo.buildVersion}\"`,\n    ]\n    use(this.packager.platformSpecificBuildOptions.legalTrademarks, it => versionKey.push(`/LANG=${localeId} LegalTrademarks \"${it}\"`))\n    return versionKey\n  }\n\n  protected async configureDefines(oneClick: boolean, defines: any) {\n    const packager = this.packager\n    const options = this.options\n\n    if (oneClick) {\n      defines.ONE_CLICK = null\n\n      if (options.runAfterFinish !== false) {\n        defines.RUN_AFTER_FINISH = null\n      }\n\n      const installerHeaderIcon = await packager.getResource(options.installerHeaderIcon, \"installerHeaderIcon.ico\")\n      if (installerHeaderIcon != null) {\n        defines.HEADER_ICO = installerHeaderIcon\n      }\n    }\n    else {\n      const installerHeader = await\n      packager.getResource(options.installerHeader, \"installerHeader.bmp\")\n      if (installerHeader != null) {\n        defines.MUI_HEADERIMAGE = null\n        defines.MUI_HEADERIMAGE_RIGHT = null\n        defines.MUI_HEADERIMAGE_BITMAP = installerHeader\n      }\n\n      const bitmap = (await packager.getResource(options.installerSidebar, \"installerSidebar.bmp\")) || \"${NSISDIR}\\\\Contrib\\\\Graphics\\\\Wizard\\\\nsis3-metro.bmp\"\n      defines.MUI_WELCOMEFINISHPAGE_BITMAP = bitmap\n      defines.MUI_UNWELCOMEFINISHPAGE_BITMAP = (await packager.getResource(options.uninstallerSidebar, \"uninstallerSidebar.bmp\")) || bitmap\n\n      if (options.allowElevation !== false) {\n        defines.MULTIUSER_INSTALLMODE_ALLOW_ELEVATION = null\n      }\n    }\n\n    if (options.perMachine === true) {\n      defines.INSTALL_MODE_PER_ALL_USERS = null\n    }\n\n    if (!oneClick || options.perMachine === true) {\n      defines.INSTALL_MODE_PER_ALL_USERS_REQUIRED = null\n    }\n\n    if (options.allowToChangeInstallationDirectory) {\n      if (oneClick) {\n        throw new Error(\"allowToChangeInstallationDirectory makes sense only for boring installer (please set oneClick to false)\")\n      }\n      defines.allowToChangeInstallationDirectory = null\n    }\n\n    if (options.menuCategory != null && options.menuCategory !== false) {\n      const menu = sanitizeFileName(options.menuCategory === true ? packager.appInfo.companyName : <string>options.menuCategory)\n      if (!isEmptyOrSpaces(menu)) {\n        defines.MENU_FILENAME = menu\n      }\n    }\n\n    if (options.multiLanguageInstaller == null ? this.isUnicodeEnabled : options.multiLanguageInstaller) {\n      defines.MULTI_LANGUAGE_INSTALLER = null\n    }\n\n    if (options.deleteAppDataOnUninstall) {\n      defines.DELETE_APP_DATA_ON_UNINSTALL = null\n    }\n  }\n\n  private configureDefinesForAllTypeOfInstaller(defines: any) {\n    const options = this.options\n\n    if (!this.isWebInstaller && defines.APP_BUILD_DIR == null) {\n      if (options.useZip) {\n        defines.ZIP_COMPRESSION = null\n      }\n\n      defines.COMPRESSION_METHOD = options.useZip ? \"zip\" : \"7z\"\n    }\n  }\n\n  private async executeMakensis(defines: any, commands: any, script: string) {\n    const args: Array<string> = (this.options.warningsAsErrors === false) ? [] : [\"-WX\"]\n    for (const name of Object.keys(defines)) {\n      const value = defines[name]\n      if (value == null) {\n        args.push(`-D${name}`)\n      }\n      else {\n        args.push(`-D${name}=${value}`)\n      }\n    }\n\n    for (const name of Object.keys(commands)) {\n      const value = commands[name]\n      if (Array.isArray(value)) {\n        for (const c of value) {\n          args.push(`-X${name} ${c}`)\n        }\n      }\n      else {\n        args.push(`-X${name} ${value}`)\n      }\n    }\n\n    args.push(\"-\")\n\n    if (debug.enabled) {\n      process.stdout.write(\"\\n\\nNSIS script:\\n\\n\" + script + \"\\n\\n---\\nEnd of NSIS script.\\n\\n\")\n    }\n\n    const nsisPath = await nsisPathPromise\n    await new BluebirdPromise<any>((resolve, reject) => {\n      const command = path.join(nsisPath, process.platform === \"darwin\" ? \"mac\" : (process.platform === \"win32\" ? \"Bin\" : \"linux\"), process.platform === \"win32\" ? \"makensis.exe\" : \"makensis\")\n      const childProcess = doSpawn(command, args, {\n        // we use NSIS_CONFIG_CONST_DATA_PATH=no to build makensis on Linux, but in any case it doesn't use stubs as MacOS/Windows version, so, we explicitly set NSISDIR\n        // set LC_CTYPE to avoid crash https://github.com/electron-userland/electron-builder/issues/503 Even \"en_DE.UTF-8\" leads to error.\n        env: Object.assign({}, process.env, {NSISDIR: nsisPath, LC_CTYPE: \"en_US.UTF-8\"}),\n        cwd: this.nsisTemplatesDir,\n      }, true)\n      handleProcess(\"close\", childProcess, command, resolve, error => {\n        reject(error + \"\\nNSIS script:\\n\" + script)\n      })\n\n      childProcess.stdin.end(script)\n    })\n  }\n\n  private async writeCustomLangFile(data: string) {\n    const file = await this.packager.getTempFile(\"messages.nsh\")\n    await outputFile(file, data)\n    return file\n  }\n\n  private async computeFinalScript(originalScript: string, isInstaller: boolean) {\n    const packager = this.packager\n    let scriptHeader = `!addincludedir \"${path.join(__dirname, \"..\", \"..\", \"templates\", \"nsis\", \"include\")}\"\\n`\n\n    const addCustomMessageFileInclude = async (input: string) => {\n      return '!include \"' + await this.writeCustomLangFile(computeCustomMessageTranslations(safeLoad(await readFile(path.join(this.nsisTemplatesDir, input), \"utf-8\"))).join(\"\\n\")) + '\"\\n'\n    }\n\n    const tasks: Array<() => Promise<any>> = [\n      async () => {\n        const pluginArch = this.isUnicodeEnabled ? \"x86-unicode\" : \"x86-ansi\"\n        let result = `!addplugindir /${pluginArch} \"${path.join(await nsisResourcePathPromise, \"plugins\", pluginArch)}\"\\n`\n        result += `!addplugindir /${pluginArch} \"${path.join(packager.buildResourcesDir, pluginArch)}\"\\n`\n        return result\n      },\n      async () => {\n        // http://stackoverflow.com/questions/997456/nsis-license-file-based-on-language-selection\n        const licensePage = await this.computeLicensePage()\n        return licensePage == null ? \"\" : createMacro(\"licensePage\", licensePage)\n      },\n      () => addCustomMessageFileInclude(\"messages.yml\"),\n    ]\n\n    if (!this.isPortable) {\n      if (this.options.oneClick === false) {\n        tasks.push(() => addCustomMessageFileInclude(\"boringMessages.yml\"))\n      }\n\n      tasks.push(async () => {\n        let result = \"\"\n        const customInclude = await packager.getResource(this.options.include, \"installer.nsh\")\n        if (customInclude != null) {\n          result += `!addincludedir \"${packager.buildResourcesDir}\"\\n`\n          result += `!include \"${customInclude}\"\\n\\n`\n        }\n        return result\n      })\n    }\n\n    for (const s of await asyncAll(tasks)) {\n      scriptHeader += s\n    }\n\n    if (this.isPortable) {\n      return scriptHeader + originalScript\n    }\n\n    const fileAssociations = packager.fileAssociations\n    if (fileAssociations.length !== 0) {\n      if (this.options.perMachine !== true) {\n        // https://github.com/electron-userland/electron-builder/issues/772\n        throw new Error(`Please set perMachine to true — file associations works on Windows only if installed for all users`)\n      }\n\n      scriptHeader += \"!include FileAssociation.nsh\\n\"\n      if (isInstaller) {\n        let registerFileAssociationsScript = \"\"\n        for (const item of fileAssociations) {\n          const extensions = asArray(item.ext).map(normalizeExt)\n          for (const ext of extensions) {\n            const customIcon = await packager.getResource(getPlatformIconFileName(item.icon, false), `${extensions[0]}.ico`)\n            let installedIconPath = \"$appExe,0\"\n            if (customIcon != null) {\n              installedIconPath = `$INSTDIR\\\\resources\\\\${path.basename(customIcon)}`\n              //noinspection SpellCheckingInspection\n              registerFileAssociationsScript += `  File \"/oname=${installedIconPath}\" \"${customIcon}\"\\n`\n            }\n\n            const icon = `\"${installedIconPath}\"`\n            const commandText = `\"Open with ${packager.appInfo.productName}\"`\n            const command = '\"$appExe $\\\\\"%1$\\\\\"\"'\n            registerFileAssociationsScript += `  !insertmacro APP_ASSOCIATE \"${ext}\" \"${item.name || ext}\" \"${item.description || \"\"}\" ${icon} ${commandText} ${command}\\n`\n          }\n        }\n        scriptHeader += `!macro registerFileAssociations\\n${registerFileAssociationsScript}!macroend\\n`\n      }\n      else {\n        let unregisterFileAssociationsScript = \"\"\n        for (const item of fileAssociations) {\n          for (const ext of asArray(item.ext)) {\n            unregisterFileAssociationsScript += `  !insertmacro APP_UNASSOCIATE \"${normalizeExt(ext)}\" \"${item.name || ext}\"\\n`\n          }\n        }\n        scriptHeader += `!macro unregisterFileAssociations\\n${unregisterFileAssociationsScript}!macroend\\n`\n      }\n    }\n\n    return scriptHeader + originalScript\n  }\n\n  private async computeLicensePage(): Promise<Array<string> | null> {\n    const packager = this.packager\n\n    const license = await packager.getResource(this.options.license, \"license.rtf\", \"license.txt\", \"eula.rtf\", \"eula.txt\", \"LICENSE.rtf\", \"LICENSE.txt\", \"EULA.rtf\", \"EULA.txt\", \"LICENSE.RTF\", \"LICENSE.TXT\", \"EULA.RTF\", \"EULA.TXT\")\n    if (license != null) {\n      return [`!insertmacro MUI_PAGE_LICENSE \"${license}\"`]\n    }\n\n    const licenseFiles = await getLicenseFiles(packager)\n    if (licenseFiles.length === 0) {\n      return null\n    }\n\n    const licensePage: Array<string> = []\n    const unspecifiedLangs = new Set(bundledLanguages)\n\n    let defaultFile: string | null = null\n    for (const item of licenseFiles) {\n      unspecifiedLangs.delete(item.langWithRegion)\n      if (defaultFile == null) {\n        defaultFile = item.file\n      }\n      licensePage.push(`LicenseLangString MUILicense ${lcid[item.langWithRegion] || item.lang} \"${item.file}\"`)\n    }\n\n    for (const l of unspecifiedLangs) {\n      licensePage.push(`LicenseLangString MUILicense ${lcid[l]} \"${defaultFile}\"`)\n    }\n\n    licensePage.push('!insertmacro MUI_PAGE_LICENSE \"$(MUILicense)\"')\n    return licensePage\n  }\n}\n\nfunction computeCustomMessageTranslations(messages: any): Array<string> {\n  const result: Array<string> = []\n  for (const messageId of Object.keys(messages)) {\n    const langToTranslations = messages[messageId]\n    const unspecifiedLangs = new Set(bundledLanguages)\n    for (const lang of Object.keys(langToTranslations)) {\n      const langWithRegion = toLangWithRegion(lang)\n      result.push(`LangString ${messageId} ${lcid[langWithRegion]} \"${langToTranslations[lang].replace(/\\n/g, \"$\\\\r$\\\\n\")}\"`)\n      unspecifiedLangs.delete(langWithRegion)\n    }\n\n    const defaultTranslation = langToTranslations[\"en\"].replace(/\\n/g, \"$\\\\r$\\\\n\")\n    for (const langWithRegion of unspecifiedLangs) {\n      result.push(`LangString ${messageId} ${lcid[langWithRegion]} \"${defaultTranslation}\"`)\n    }\n  }\n  return result\n}\n\nfunction createMacro(name: string, lines: Array<string>) {\n  return `\\n!macro ${name}\\n  ${lines.join(\"\\n  \")}\\n!macroend\\n`\n}"
  ]
}
